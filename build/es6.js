"use strict";var __awaiter=function(t,e,o,n){return new(o||(o=Promise))((function(i,a){function r(t){try{s(n.next(t))}catch(t){a(t)}}function c(t){try{s(n.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,c)}s((n=n.apply(t,e||[])).next())}))};document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("whoami"),e=location.origin+"/api/";let o=!1;const n=n=>__awaiter(void 0,void 0,void 0,(function*(){o=!1,t.innerText="Inte inloggad";const a=((t,o,n)=>__awaiter(void 0,void 0,void 0,(function*(){const a=e+t;o||(o={}),o.headers||(o.headers={}),o.headers.Authorization="Bearer "+(n||localStorage.getItem("ScoutID-JWT-Token"));const r=yield fetch(a,o);if(r.ok)return yield r.json();if(498!==r.status)throw r;if(n)throw r;if(!(yield i(!1)))throw r;o.headers.Authorization="Bearer "+localStorage.getItem("ScoutID-JWT-Token");const c=yield fetch(a,o);if(!c.ok)throw c;return yield c.json()})))("jwt/verify_token",{},n);try{yield a}catch(t){throw console.error(t),t}const r=yield a;if(!1===r.user)throw new Error("No user");const c=r.data.karer?Object.values(r.data.karer):[];let s=null;return c.length>2?s=c.slice(0,c.length-1).join(", ")+" och "+c[c.length-1]:c.length>0&&(s=c.join(" och ")),t.innerText="Inloggad som "+r.data.name+(s?" frÃ¥n "+s:""),o=!0,!0})),i=e=>__awaiter(void 0,void 0,void 0,(function*(){const i=localStorage.getItem("ScoutID-JWT-Token");if(i)try{yield n(i)}catch(t){localStorage.removeItem("ScoutID-JWT-Token")}if(!o){let i=(r="https://beta.scoutid.se/jwt/jwt.php",c={credentials:"include"},__awaiter(void 0,void 0,void 0,(function*(){const t=yield fetch(r,c);if(!t.ok)throw t;return yield t.json()})));try{yield i}catch(e){if(!e.json)return console.error(e),t.innerText="Inte inloggad",!1;i=e.json();try{yield i}catch(e){return console.error(e),t.innerText="Inte inloggad",!1}}const a=yield i;if(a.ok){try{yield n(a.token)}catch(e){return console.error(e),t.innerText="Inte inloggad",!1}localStorage.setItem("ScoutID-JWT-Token",a.token)}!o&&e&&(location.href=a.url)}var r,c;return o&&("#!/login/"===location.hash.substr(0,9)?location.hash="#!/"+location.hash.substr(9):"#!/login"===location.hash?location.hash="#!/":e&&a()),o})),a=()=>__awaiter(void 0,void 0,void 0,(function*(){if(document.body.classList.toggle("guest",!o),!o){switch(location.hash){case"#!/login":return i(!0);case"#!/":case"":return}return"#!/login/"===location.hash.substr(0,9)?i(!0):void 0}switch(location.hash){case"#!/":case"":return;case"#!/logout":return localStorage.removeItem("ScoutID-JWT-Token"),o=!1,t.innerText="Inte inloggad",void(location.hash="#!/")}}));window.addEventListener("hashchange",a),__awaiter(void 0,void 0,void 0,(function*(){document.getElementById("login-button").addEventListener("click",t=>{location.hash.length>3&&"#!/"===location.hash.substr(0,3)&&(t.preventDefault(),location.hash="#!/login/"+location.hash.substr(3))}),"skojjt.webservices.scouterna.net"!==location.hostname&&("skojjt-staging.webservices.scouterna.net"===location.hostname?document.title+=" Stage":document.title+=" Dev"),yield i(!1),yield a()}))});
//# sourceMappingURL=es6.js.map
