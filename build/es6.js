"use strict";var __awaiter=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function d(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,c)}a((o=o.apply(e,t||[])).next())}))};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("whoami"),t=(e,t)=>__awaiter(void 0,void 0,void 0,(function*(){const n=yield fetch(e,t);if(!n.ok)throw n;return yield n.json()})),n=n=>__awaiter(void 0,void 0,void 0,(function*(){let o=t("https://beta.scoutid.se/jwt/jwt.php",{credentials:"include"});try{yield o}catch(t){if(!t.json)return console.error(t),e.innerText="Not logged in",!1;o=t.json();try{yield o}catch(t){return console.error(t),e.innerText="Not logged in",!1}}const i=yield o;if(i.ok){try{yield(i.token,__awaiter(void 0,void 0,void 0,(function*(){return e.innerText="Logged in as ??? from ???",!0})))}catch(t){return console.error(t),e.innerText="Not logged in",!1}return localStorage.setItem("ScoutID-JWT-Token",i.token),!0}return n&&(location.href=i.url),!1}));__awaiter(void 0,void 0,void 0,(function*(){const e=document.getElementById("ping"),n=document.getElementById("dbcheck"),o=t("/ping");try{yield o}catch(t){return console.error(t),void(e.innerText="Rest-API failed: "+(t.statusText||t))}if("pong"!==(yield o).ping)return void(e.innerText="Rest-API bad response.");e.innerText="Rest-API is working",n.innerText="Testing db-connection?";const i=t("/api/dbtest");try{yield i}catch(e){return console.error(e),void(n.innerText="DB-test failed: "+(e.statusText||e))}const r=yield i;r.ok&&!isNaN(r.count)?n.innerText="Database connection is working, counter = "+r.count+".":n.innerText="DB-test bad response"})),(()=>{const e=document.getElementById("login");e.addEventListener("submit",t=>__awaiter(void 0,void 0,void 0,(function*(){t.preventDefault(),e.hidden=!0,yield n(!0)}))),n(!1)})()});
//# sourceMappingURL=es6.js.map
